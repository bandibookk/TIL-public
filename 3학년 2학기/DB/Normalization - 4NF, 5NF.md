# Normalization - 4NF, 5NF
고급 정규형. 여기 까지는 보통 따지지 않는다고 함. 

## 1. 다중치 종속성 MVD
Multivalued Dependency. `X ->-> Y`와 같이 나타낸다. <br>
<!-- (아래는 책의 설명을 그대로 쓴 것이라 이해가 어려울 수 있다. 설명이 필요) <br> -->
어떤 릴레이션 스키마 R과, R에 속한 애트리뷰트들의 부분 집합 X, Y가 있을 때, R의 모든 하헙법적 인스턴스 r에 대해 <br>
X의 값이 Y의 값들의 집합(즉, 여러 개의 Y 값들이 가능)과 연관되며, 이러한 연관되는 집합이 다른 애트리뷰트들과의 값과는 무관할 경우, **다중치 종속성 `X ->-> Y` 가 R에서 성립된다.**  <br>

MVD의 공식은 아래와 같다. <br>
만약 `X ->-> Y`가 R에서 성립되고, `Z = R - XY`라면, R의 모든 합법적인 인스턴스 r에 대해 아래를 만족한다.

![화면 캡처 2022-11-16 192825](https://user-images.githubusercontent.com/71186266/202167963-9038de80-1872-44dd-acd1-024f7b9bfcc7.png)

<br>

|   X   |   Y   |   Z   |          |
| :---: | :---: | :---: | :------: |
|   a   |  b1   |  c1   | tuple t1 |
|   a   |  b2   |  c2   | tuple t2 |
|   a   |  b1   |  c2   | tuple t3 |
|   a   |  b2   |  c1   | tuple t4 |

말이 너무나도 어려운데, `X ->-> Y`이고, `Z = R - XY` 때, 같은 X 값에 대해 다른 Y값이 있는 투플 두 개가 있을 때, 둘 중 하나의 투플과 X, Y 값이 같은 앞선 두 개의 투플과 다른 하나의 투플을 생각한다. 그 투플의 Z값은 앞선 두개 중 나머지 하나의 값과 같은 수 있다는 것이다. <br>

너무 어려운 말을 풀어서 아직도 어렵다 ㅋㅋ <br>
진짜 진짜 한번 더 풀자면, `X ->-> Y`이고, Y와 Z는 무관한 것이다. **Y가 Z를 결정하지 않는 것이다.** 
<br>

**투플 t3, t4가 없다면 위에서 MVD가 성립되지 않는다는 것이다.** <br>

`X ->-> Y`가 성립된다고 말 할 수 있으려면, X와 Y의 나머지가 Y에 대해 결정되지 않아야 한다는 것이다.

## 2. 제4 정규형
R에서 성립되는 모든 MVD `X ->-> Y`에 대해 아래 중 한가지가 성립해야함
1. Y는 X에 속함
2. XY = R
3. X는 슈퍼키이다.

**CTB 예시**

<br>

|   course   | teacher |   book    |
| :--------: | :-----: | :-------: |
| Physics101 |  Green  | Mechanics |
| Physics101 |  Green  |  Optics   |
| Physics101 |  Brown  | Mechanics |
| Physics101 |  Brown  |  Optics   |
|  Math301   |  Green  | Mechanics |
|  Math301   |  Green  |  Vectors  |
|  Math301   |  Green  | Geometry  |

위의 예시를 보자. <br>
Teacher는 Course를 가르치고, 책 B가 이 과목의 교재로 추천됨. <Br>

1. 어떤 과목에 대한 교재가 나타날 떄마다 해당 교사가 가르치는 과목이 매번 반복되어 기록된다.
2. 어떤 과목에 대한 담당교수가 나타날 때마다, 해당 과목의 추천 교재가 매번 반복되어 기록된다.

**결국 teacher와 book은 무관하다!** <br>
결국 다중치 종속성이 여러개인 것이 문제이다. `C ->-> T`이고, `C ->-> B`인 것이 한 테이블에 나타난 것이 문제이다. <br>

이에, **CT, CB로 테이블을 나누어 주면, XY = R로 4NF를 만족시켜줄 수 있다!**

## 3. 조인 종속성과 제5 정규형
### 조인 종속성 JD
MVD의 개념이 일반화 된 상태. 
만약 R1, ..., Rn이 어떤 릴레이션 R에 대한 무손실 조인 분해라면, **조인 종속성이 성립된다.** <br>

`X ->-> Y` 는 조인 종속성 {XY, X(R - Y)}로 표현할 수 있음.

<br>

### 제5 정규형 (5NF)

릴레이션 R에 성립되는 모든 JD에 대해 아래 중 하나를 만족한다면 제 5정규형에 속한다고 한다.
- 어떤 i에 대해 Ri = R이 성립한다.
- R에 대한 FD들 중 좌측이 R의 키인 FD들의 집합으로 부터 JD가 유도된다. <br> -> R의 Key로 만든 FD들의 집합으로, JD가 유도되냐는 뜻. 즉, 키의 집합으로 종속성을 설정한 테이블들이 완전히 조인종속성을 가지냐?인듯.

<br>

말이 어려운데, JD의 고려 없이 5NF 여부를 판단할 수도 있다. <br>

**만약 어떤 릴레이션 스키마가 3NF에 속하며, 이 릴레이션의 모든 키들이 각각 단일 애트리뷰트만으로 구성된다면, 이 릴레이션은 역시 5NF에도 속한다.** 두 번째 조건에 대한 설명인거 같다.

<br> <Br>

MVD와 달리 JD는 정당하고 완전한 추론 법칙이 존재하지 않는다. 그리고, 어떤 릴레이션이 5NF에 속한다는 사실은 충분 조건이 될 수 있지만, 필요 조건은 아니라고 한다.


Database Management Systems \<Raghu Ramakrishnan, Johannes Gehrke>
