
# 3.6 View
뷰!(View)는 **내가 정의하는 테이블**입니다. **실제로 데이터베이스에 저장하지 않고,** 테이블을 내가 필요한 논리적인 단위로 떼어 만드는 느낌입니다.<br>

이름에 힌트가 있습니다. View는 Table을 보는 하나의 '창'입니다. 창 안 쪽으로 보이는 물건들을 내 맘대로 꺼내었다가 뺄 수 있을까요? 당연히 쉽지 않습니다. 이에, 제약이 따릅니다. 뷰를 통해 기본 테이블의 내용을 쉽게 검색할 수는 있지만, 기본 테이블의 내용을 바꾸는 작업은 제한적으로 이루어집니다.

<br>

이런 뷰 정의를 이용해 직접 정의하여 사용한다. <br> 예를 들어 Student라는 테이블과 Enrolled라는 테이블에서 A학점을 받은 학생들의 이름, 학번, 과목 번호를 검색하길 원한다고 가정할 때, 아래와 같이 뷰를 정의할 수 있다.
```sql
CREATE VIEW A-Students (name, sid, course)
    AS SELECT S.name, S.sid, E.cid
    FROM Students S, Enrolled E
    WHERE S.sid = E.studid AND E.grade = 'A'
```
이를 통해 `A-Students`라는 가상의 테이블이 생겨나게 되고, 이는 실제로 저장된 테이블처럼 사용할 수 있다

## 3.6.1 가상의 테이블? -> 실제로 저장 되지 않는다?
뷰는 가상의 테이블이고, 실제로 저장 되지는 않는다는데 어떻게 `SELECT` 문과 같은 쿼리를 걸 수가 있을까? <br>

**뷰에 대한 쿼리는 내부적으로 기본 테이블에 대한 쿼리로 변환되어 수행되기 때문이다.** 이런 마법같은 변환 **덕분에** 편하게 데이터를 가져올 수 있고, 이런 무서운 변환 **때문에** INSERT, UPDTAE, DELETE와 같은 쿼리에 **기본 테이블이 변해버린다.**

<br>

그러나 위에서 언급한 것과 같이, 이러한 조작에는 제한이 있다. 변경이 가능한 뷰와 불가능한 뷰에 대해 알아보자.

## 3.6.3 뷰와 연산 거부 승인
1. `INSERT`
`INSERT`는 튜플을 집어넣는 연산이다. VIEW에 `INSERT`를 해줄 떄, VIEW에 나타나지 않는 애트리뷰트는 어떻게 될까? 바로 **null 값이 채워지게 된다.** <br> **NULL값? PK가 null값이면 어떻게 될까? 당연히 `INSERT`가 거부된다!** <br> PK는 유일하게 하나의 값을 가져야만 하기 때문에, PK가 없는 INSERT가 걸리게 된다던지, 유일하지 않은 PK값을 싣게 되면 연산이 거부된다! <br> 이는 `UPDATE`, `DELETE`연산에도 똑같이 적용된다! <br> **결국, 기본 테이블의 NOT NULL 속성이 지정된 뷰는 변경할 수 없는 경우가 있다.**

2. **집계함수로 계산된 값은** 기본 테이블이 원래 포함하고 있던 내용이 아니고 내가 필요에 의해 만든 값이기 떄문에, 연산이 허용되지 않는다.
3. `DISTINCT`, `GROUP BY`를 포함하여 정의한 뷰는 변경할 수 없다.
4. **여러개의 테이블을 조인하여 정의한 뷰는 변경할 수 없는 경우가 많다.**
5. 결론: 기본 테이블에서 어떤 투플을 어떻게 변경해야 할지 명확하지 않으면 전부 거부된다.


## 3.6.4 뷰 왜 쓰나요?
이렇게 까다로운 뷰.. 왜 쓸까요?

1. **논리적 데이터 독립성을 지원합니다** <br> 논리적으로 필요한 자료로 끊었기에, 나머지 부분들에 대해 신경을 적게 써도 된다.. 이는 편리함을 가져온다.
2. 보안의 관점에서도 좋다. 
예를 들어, 학생의 테이블에서 전체를 공개하기는 좀 그렇고 부분만 공개하고 싶을 때, 공개 가능한 애트리뷰트들만 떼어서 뷰를 정의해주고, 그렇게 새로 만든 뷰를 공개하면된다.
3. **질의문을 좀 더 쉽게 작성할 수 있습니다.** <Br> 뷰 자체가, 여러 조건들 하에 만들어지기 때문에, 뷰를 가져올 떄는 `SELECT`와 `FROM` 만으로도 해결이 될 떄가 많다! `WHERE`, `GROUP BY`를 이미 써서 만들었기 때문에 이미 걸러져 있기 때문이다!
 
## 3.6.3 테이블 뷰 제거, 변경
```sql
DROP Students RESTRICT
```
`DROP Students RESTRICT`와 같은 명령으로 제거 가능하다. 어떤 뷰나, 무결성 제약조건이 Student를 참조하지 않으면 제거합니다. <br> <br>

```sql
DROP Students CASCADE
```
`DROP Students CASCADE`는 Students를 제거하고, 이를 참조하는 뷰나 무결성 제약조건 또한 연쇄적으로 제거됩니다. <br> <br>

`ALTER TABLE`은 기존 테이블의 구조를 수정합니다. maiden-name라는 열을 Students에 추가하기 위해, 아래와 같은 명령어를 사용할 수 있습니다. 기존의 모든 행들은 NULL로 채워집니다.
```sql
ALTER TABLE Students 
    ADD COLUMN maiden-name CHAR(10)
```

### Reference
- 데이터 베이스 개론 <김연희 저>
- 데이터 베이스 시스템 \<Raghu Ramakrishnan 저>
