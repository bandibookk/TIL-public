# Spring WebSocket과 STOMP (1)
안녕하세요? 진호우!^^입니다. <br> 오늘은 제가 사용자간 채팅 어플리케이션을 만들며 익힌 내용들을 정리해 보겠습니다. <br> 사실 예전에 만들었던 클라이언트 어플리케이션에 NoSQL을 이용한 간단한 채팅 기능을 구현한 적이 있어, 이번 구현도 간단할 것으로 생각하고 시작했으나, 생각보다 어려웠고, 자료들도 찾기 힘들었기에.. 이렇게 글을 씁니다. <br> <br>

이전에는 Firebase를 이용한 NoSQL 기반의 DB에 이벤트 리스너를 달아 주어서, 각 유저간의 관계를 가지는 DB에 변화가 생길 경우 내용들을 가져오는 식으로 구현했었습니다. 그 당시에는 어려웠지만, 지금 생각해보면 정말 간단한 방법입니다... <br> 이 때의 기억으로 가벼운 마음으로 시작했으나, 결국 Socket 프로그래밍까지 공부 해보는 기회(?) 되었습니다. <br> 

막 구현하기가 어렵지는 않습니다만, 이해하는 과정이 조금 어려웠던 것 같습니다. 최대한 이해하기 쉽게 글을 써 보겠습니다. <br> <br>

글 중간 중간에 제가 평소에 헷갈려 했던, Handler나, End Point와 같은 개념들 또한 이해하기 좋게 설명 해보겠습니다. <br>


## 1. 왜 Spring WebSocket인가?
채팅 기능을 구현하는 방식에는 여러가지가 있습니다. 대표적으로 **Polling, Server-Sent-Events(SSE), 그리고 WebSocket**의 3가지 방법이 있습니다. <br> 이 세가지 방법을 간단하게 알아보면서 왜 WebSocket을 이용해야 하는지 설명 드리겠습니다.


### 1.1 Polling
**Polling**이란? 말 그대로 서버의 데이터를 **주기적으로 열어 보는 것입니다.** 서버의 변동 내용들을 따로 감지하지 않고, 정해진 주기대로 데이터를 꺼내 가져오는 것입니다! <br> <br>

Polling은 그냥 보아도 채팅기능을 구현하기에는 문제점이 많습니다.. 아무래도 채팅은 빨라야 하니 1초 간격으로 받아오도록 설정한다면? <br> 10분 20분 마다 채팅을 치는 회원들이 있을 수 있으니, 큰 비효율을 야기합니다. 그렇다고 간격을 늘리면, 짧은 시간 동안 여러 대화를 주고 받는 회원들에게 불편함을 유발할 수 있습니다... <br> 이 때문에, Polling은 채팅 기능을 구현하기에 좋은 기능이 아닙니다.. 

<br>

TMI: Poll을 영어사전에서 검색해보면, **개표하다** 정도의 뜻임을 알 수 있습니다. 저도 프로그래밍에서 Poll이라는 단어를 볼 때마다, 의아했는데, 생각 해보면, 개표란 내용을 모르는 투표함에서 투표지를 꺼내 열어보는 행위입니다. 때문에 **데이터를 꺼내어 내용을 확인하는 작업들을 프로그래밍에서 Poll이라고 많이들 부르는 것 같습니다.** JAVA 자료구조들을 공부하다 보면 종종 나오는 용어입니다.

<br> 

### 1.2 SSE (Server-Sent-Events)
다음은 SSE입니다. 서버에 이벤트가 발생할 때마다, 정보를 갱신하는 방식입니다. <br> 어디서 많이 본 방법인가 하니.. 제가 예전에 어플리케이션에 채팅 기능을 구현할 때 썼던 방십니다. 그 때는 용어도 모르고 사용했던 기법인데 이번 기회를 통해 알게 되었습니다. <br> Polling과 달리, SSE는 쓸데없는 정보의 송수신이 없기 때문에, 훨씬 효율적입니다. <br> Polling에 비하면 꽤나 효율적이고 좋은 방식입니다. 단, 지원하지 않는 브라우저들이 있고, 단방향 통신만 지원하며, 무엇보다 계속해서 DB나 서버의 변화를 감지해야 하기 때문에, **세션을 계속해서 열어두어야 하는 단점이 있습니다.** <br> <br> WebSocket을 이용하는 방식은 다릅니다! <br> 필요할 때만 3-way handshake를 통해 연결을 하기 때문에 좀 더 효율적인 방식으로 교환할 수 있습니다! 

### 1.3 Spring WebSocket
Spring WebSocket을 이용하면 양방향 통신이 가능하고, 필요할 때만 통신할 수 있습니다!
