# Docker

![docker](https://user-images.githubusercontent.com/71186266/210125841-1cff80c5-eec6-4de2-8b84-e840ea3d92cd.png)

도커란 무엇인가? <br>

### 도커는 컨테이너 기반의 오픈소스 가상화 플랫폼이다.
도커는 컨테이너를 사용해 응용프로그램을 더 쉽게 만들고 배포하고, 실행할 수 있게 설계된 도구이며, 컨테이너 기반의 오픈소스 가상화 플랫폼-생태계이다. <br>
기존의 가상머신들은 매우 무겁게 움직였다. OS를 전부 복제하든 일부만 복제하든, OS를 가상화 하는 과정에서 복제가 수반되며, 비용이 너무 커져 매우 느리고 무겁게 움직였다. <br>
도커는 `리눅스 컨테이너`라는 기술을 기반으로 만들어졌는데, 이 컨테이너 기술은 따로 OS를 가상화하지 않고, **프로세스를 격리한다.** <br>

리눅스 컨테이너는 이런 프로세스 격리 방식만으로 OS 가상화의 효과를 누리면서도, 아주 가볍고 빠른 동작을 얻어낼 수 있었다. CPU나 메모리를 딱 프로세스가 필요한 만큼만 추가로 사용하고, 성능적 손실도 거의 없다. <br>

이런 아이디어는 매우 혁신적인데, 새로운 컨테이너를 만드는데엔 1초도 채 걸리지 않는다고 한다. 하나의 서버에 여러 컨테이너를 사용해도 서로 영향을 미치지 않고 독립적으로 실행되니, 여러 VM을 쓰는 효과를 누릴 수가 있다. 그것도 아주아주 가벼운 비용으로! <br>
어쩌다 VM을 쓰는 일을 옆에서 지켜볼 일이 있었는데, 그 때 본 VM의 무겁고 느린 구동을 떠올리면 정말 감격스러울 따름. <br>

## 1. Container

![docker container](https://user-images.githubusercontent.com/71186266/210125838-113e7bb3-a6c5-45ec-98ea-940b6dd973ad.png)

도커 메인 사이트에 들어가면 `What is Docker?`라는 메뉴 탭이 있다. 도커가 뭔지 공식 사이트에서 알려준다는데, 이 메뉴 탭을 누르면 바로 `what is a Container`라는 설명 부터 나온다. <br>
도커에 대한 이해를 위해선 Container에 대한 이해가 먼저라는 것이다. <br>

설명을 읽어도 중간 중간 이해가 안 갈 수 있는데, 마음 편하게 쭉 읽어보면 마지막에 모든 개념을 종합해서 설명하겠다. <br> <br>

**컨테이너는 코드와 모든 종속성을 패키지화하여 응용 프로그램이 한 컴퓨팅 환경에서 다른 컴퓨팅 환경으로 빠르고 안정적으로 실행되도록 하는 소프트웨어 표준 단위이다.** 일단은 `간단하고 편리하게 프로그램을 실행 시켜주는 것`으로 생각하면 된다. <br>

앞서 언급한대로 컨테이너를 프로세스를 격리한 공간으로 생각하면 될 것 같은데, 이런 컨테이너는 **도커 이미지를 통해 만들어진다.** <br> <br>


## 2. Docker Image

**Docker Container Image는 코드, 런타임, 시스템 도구, 시스템 라이브러리 및 설정과 같은 응용 프로그램을 실행하는 데에 필요한 모든 것을 포함하는 가볍고 독립적이며, 실행 가능한 소프트웨어 패키지이다.** <br>

말이 어려운데 구체적인 예시를 보면 쉽다. MySQL 이미지는 MySQL 실행을 위한 명령어, 포트 정보등을 모두 가지고 있고, ubuntu 이미지는 ubuntu 실행을 위한 모든 파일들을 가지고 있다! <br>

![docker image](https://user-images.githubusercontent.com/71186266/210125839-b41208f3-9c39-4997-870b-81649659826b.png)

**컨테이너는 도커 이미지의 인스턴스이다!** 이해에 가장 좋은 표현이다. <br> 
**도커 이미지를 이용해서 컨테이너를 만들어낼 수 있는데,** 인스턴스라고 표현한 만큼, 하나의 이미지로 여러 컨테이너들을 만들어낼 수 있다.
컨테이너는 이미지를 실행한 상태라고 볼 수도 있고, 컨테이너에서 추가되거나 변하는 값은 이미지가 아닌 **컨테이너에 저장된다.** **컨테이너의 상태가 바뀌거나 삭제되더라도 이미지에는 영향을 미치지 않는다는 것이다.**  <br>

이미지는 컨테이너 실행을 위한 모든 것을 가지고 있기 때문에 이제는 힘들게 의존성 파일을 컴파일하고 이것저것 설치할 필요가 없는 것이다. <br>

이미지는 URL 방식으로 관리된다.

## 3. Image의 Layer 개념
도커 이미지는 유니온 파일 시스템을 통해 여러 Layer를 하나의 파일 시스템 Image로 이용할 수 있다. <br>

![docker layer](https://user-images.githubusercontent.com/71186266/210125840-82dee471-5d33-4f54-ae32-a28bbf4947b8.png)

도커 이미지는 앞서 언급한 것 처럼 아주 방대한 정보들을 담고 있기 때문에, 용량이 작지 않다. 그렇기 때문에, 기존 이미지에 파일 하나 추가와 같은 작은 변화가 일어났다고 해서 큰 용량의 이미지를 다시 다운 받는다면 큰 손해라고 할 수 있다. <Br>
**이에, 도커는 Image를 만들 때 Layer개념을 이용한다.** <br>
하나의 이미지는 여러 Layer로 구성 되어있다. 파일이 추가되거나 수정이 필요한 경우 그저 한 레이어가 추가되거나 변경될 뿐이다. <br>
이미지는 이런 Layer들의 Union이므로, 어떤 파일의 추가가 필요할 때는, 작은 Layer하나만 받으면 알아서 변경이 반영된 Image가 형성되는 것이다. <br>
가상화 특성상 이미지의 용량은 클 수 밖에 없고, 여러대의 서버에 배포해야하기 때문에, 이런 방식은 단순하지만 강력하다.

## 4. Image를 통해 Container가 만들어지는 과정

이미지는 응용 프로그램을 실행하는데 필요한 모든 것을 포함하고 있다. <br>
1. `실행 명령어`: 컨테이너가 시작 될 때 실행되는 명령어 ex) run hello-world
2. `파일 스냅샷`: 프로그램을 실행하는데 필요한 파일들의 디렉토리나 파일을 카피한 것.

위의 두 가지 요소를 이용해 컨테이너를 만들게 되는데 그 순서는 아래와 같다. 

1. Docker 클라이언트에 `docker run \<이미지 이름>` 입력
2. 도커 이미지에 있는 **파일 스냅샷을** **컨테이너 하드 디스크에** 옮겨준다. -> 어떤 프로그램을 실행하기 위해 일단 저장소를 확보하는 느낌으로 이해하자.
3. 이미지가 가진 시작시 실행 명령어를 가져와서 프로그램을 실행시킨다.

![이미지로 컨테이너 만들기](https://user-images.githubusercontent.com/71186266/210169247-ab075337-a3f1-4d07-90a2-acf3fe0917f6.png)


명령어 작동 순서와 함께 종합해보면,. <Br>
`docker run 이미지` 명령어가 실행되면, 도커 서버에 명령이 보내진다. 도커 서버에 컨테이너를 위한 이미지가 이미 캐쉬되어 있는지 확인하고 사용한다. 만약에 캐쉬 되어있지 않은 경우, 도커 허브에서 다운 받아온다. <Br> 
**이후 이미지가 가진 정보들을 확인한다. 컨테이너 하드 디스크에 이미지 안에 있는 파일 스냅샷을 옮겨주고, 이미지가 가진 명령어를 실행한다!**

## 5. Docker
**도커는 짱이다.** <br>
도커는 여러 Layer들을 모아 실행 가능한 프로그램 '이미지'를 만들어낸다. 그리고 이런 이미지를 통해 인스턴스 격인 '컨테이너'를 만들어 내는데, 컨테이너는 VM처럼 가상화된 OS와 같이 사용할 수 있지만, 실제로 가상화 OS가 아니라 단순히 프로세스를 격리한 것이기 때문에 아주 아주 가볍고 빠르게 동작한다. <Br>
도커는 아주 짱인데, 부가적으로 편리한 요소들이 너무나도 많다. <br> 
이미지를 만드는 과정을 자체 언어로 기록하고 저장하는 `Dockerfile`이 있기 때문에 따로 어디에 기록할 필요 없고, 무거운 Docker Image들을 쉽게 저장하고 다운받을 수 있도록 `Docker Hub`를 무료로 제공해준다. Command와 API도 매우 잘 만들어진 편이며, 불편사항이나 피드백을 빠르게 반영하고, 커뮤니티 또한 활발하다. <br>
그리고 캐릭터가 귀엽다.. 도커는 짱이다 도커는 신이다 도커하자.


# Hello! Docker!
안녕! 도커!
  
![hello](https://user-images.githubusercontent.com/71186266/210127133-e9a344e1-ad14-4114-a44f-7f4057522b26.png)

1. 도커 클라이언트 (Windows Power Shell)에 `docker run hello-world`를 입력했다.
2. 명령어가 도커 서버로 이동된다.
3. **서버는 이미지 Cache 보관 장소에서 hello-world라는 이미지가 있는지 확인한다.**
4. 위의 캡쳐에서는 해당 이미지가 캐시 보관 장소에 없어서, Unable to find image라는 문구가 나왔다.
5. 없는 경우 도커 허브에서 이미지를 가져온다! 이후, 실행한다.
6. **Hello! Docker!**
  
## Reference
- [따라하면서 배우는 도커와 CI 환경](https://www.inflearn.com/course/%EB%94%B0%EB%9D%BC%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8F%84%EC%BB%A4-ci/dashboard)
- [초보를 위한 도커 안내서 - 도커란 무엇인가?](https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html)
