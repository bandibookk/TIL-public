# 2.4 도메인 영역의 주요 구성요소
도메인의 주요 개념과 핵심 로직들은 도메인 영역 모델에 구현된다. <Br>
도메인 영역은 도메인 핵심 모델을 구현하는 곳이다. <br>
이제 도메인 영역을 구성하는 다양한 요소를 알아보자.


## 1. Entity
옛날 부터 엔티티의 정의가 헷갈릴 때가 많았다. <Br>
그냥 객체랑 뭐가 다른가.. DB에 들어간다는 차이가 있다고 희미하게 생각할 뿐이였다. <br>
도메인 모델의 엔티티는 단순히 데이터를 담고 있는 자료구조가 아니다. <Br>
**고유한 식별자와 자신만의 라이프 사이클을 갖는 객체로, <br> 데이터와 함께 기능을 제공하는 고유한 개념을 표현하는 객체이다.** <br>
예를 들어 Order, Member, Product는 DB 안에서 각자의 식별자를 갖는다. 그리고 고유한 개념을 나타낸다. <Br> 
객체가 데이터와 기능을 제공하는건 특별한 일은 아니다. <Br>
**다만 식별자를 갖는 객체라는 점이 다르다.** <Br>
예를 들어 밸류 타입인 Address나, Money를 생각해보자. 아니면 Repository나 Service는? <Br>
따로 고유한 식별자를 가지고 있지 않다 <Br>
후자는 주로 싱글턴으로 구현되기 때문에 적절한 비유가 아닐 수도 있지만, 내 말을 이해했을 것이라고 믿는다. <br> <Br>

### DB 엔티티 vs 도메인 엔티티
둘을 거의 비슷한 것으로 오해하기 쉽다. <br>
**하지만 도메인 모델의 엔티티와 DB 모델의 엔티티 또한 구분해야 한다.** <Br>
**둘의 가장 큰 차이점은 '기능'에 있다.** <br>
DB 모델의 엔티티도 기능을 제공하는가? 절대 아니다. <br>
아니면 밸류 타입을 가지고 있는가? RDBMS와 같은 경우 표현이 어렵다. <Br>
DB의 엔티티는 단순한 데이터 구조와 가깝다. <Br>

## 2. Value
밸류는 **고유한 식별자를 갖지 않는 객체들을** 의미한다. <Br>
**주로 개념적으로 하나인 개념을 표현할 때 사용하는데,** <br> 
앞서 예시를 든 '주소'는 내부적으로 '나라', '시', '동' 등을 가지고 있을 수 있고, <BR>
Money는 int value 하나 만을 가지고 '돈'의 역할과 책임을 줄 수 있다. <br>
밸류 타입은 엔티티의 속성으로 이용할 수 있고, 밸류 타입의 속성으로도 사용할 수 있다.

### 불변 밸류 타입
밸류 타입 데이터는 불변으로 구현할 것을 권장한다. <Br>
구현시 내부 속성 값들을 수정하지 말고, 아예 새로 만들 것을 권장한다. <br>
외부에서 함부로 수정할 수 없는 불변 타입이 된다면 <br> 
변경 가능성을 없애고, 안전한 코드를 만들 수 있는데, 불변 객체는 참조 투명성을 가지고, Thread Safe하기 때문이다. <br>

## 3. Aggregate
**애그리거트는 도메인에서 관련된 객체들을 하나로 묶어낸 군집을 나타낸다.** <Br>
한 프로그램 안에서, 우리는 다양한 기능들을 제공한다. <br>
예를 들어 쇼핑몰을 생각해보자. <br>
우리는 쇼핑몰에서 '가입', '검색', '주문', '상품 등록' 등의 기능들을 이용할 수 있다. <br>
그리고 다음 개념들을 생각해보자. '주문', '배송지 정보', '주문 목록', '총 결제 금액' 등의 개념들은 
'주문'이라는 단 하나의 개념으로 묶어, '주문'을 상위 개념으로, 나머지를 하위 개념처럼 다룰 수 있다. <Br>
이런 에그리거트를 통해 아주 크고 복잡한 모델의 구조를 쉽게 이해할 수 있다. <Br>
거대한 개념의 군집과 군집의 상호작용으로 프로그램을 이해하면서, 더 심플한 구조를 확보할 수 있게 된다. <br> <br>

### 루트 엔티티
뿐만 아니라 애그리거트를 대표하는 '루트 엔티티'를 앞세워, 
나머지는 에그리거트 안에서만 소통할 수 있게 구현한다면? <Br>
자연스럽게 의존도를 낮추고 응집도를 높힐 수 있다. <br>
프로그램은 애그리거트 루트가 제공하는 기능들을 사용하고, 
간접적으로 애그리거트 내부 엔티티나 밸류에 접근한다. <br>
이것은 애그리거트 내부 구현을 숨김으로써, 훌륭한 캡슐화를 달성하는데 큰 도움을 준다. <Br>


## 4. Repository
도메인 객체들의 영속성을 위해선.. DB나 파일과 같은 '외부 저장소'는 필수라고 할 수 있다. <Br>
**이를 위한 모델을 Repository라고 부른다.** <Br>
엔티티나 밸류는 프로그램의 요구사항에서 도출되는 모델이다. <Br>
그에 비해 리포지토리는 구현을 위한 도메인 모델이다. <br>
애그리게이트 단위로 도메인 객체를 저장하고 조회하며 지우는 등의 '영속성'에 관여한다. <Br>
애그리거트 루트를 기본 단위로 삼아 사용한다. <Br>
도메인 엔티티를 사용하려면, 엔티티에 대한 현재 정보를 파악해야 한다. <br>
리포지토리를 통해 도메인 객체를 가져온 다음, 도메인 객체의 기능을 수행하는 코드를 작성할 수 있다! <Br>
리포지토리는 도메인 모델 관점에서, **객체를 영속화하는데 필요한 기능들을 추상화한 고수준 모듈이다.** <Br>
이를 구체적으로 구현한 클래스는 저수준 모듈로 인프라스트럭처 영역에 속한다. <Br>
헷갈릴 수 있는데, 간단한 이야기다. <Br> 
예를 들어 회원 리포지토리를 `MemberRepository` 고수준 모듈 인터페이스로 구현했다. <Br>
필요에 따라 RDBMS나 NoSQL을 이용해 MemberRepository를 구현할 수 있는데, 
이 구현체들은 인프라스트럭처 영역에 속한다고 할 수 있다. <br>

응용 계층의 서비스는 의존성 주입이나 여러 방식을 통해 리포지토리 구현 객체에 접근할 수 있다. <Br>

## 5. 도메인 서비스
**특정 엔티티에 속하지 않은 도메인의 로직을 제공하는 곳이다.** <br>
예를 들어, 할인 금액은 누가 계산해야 하는가? <br>
상품 도메인이 계산해야 하는가? 그래 보일 수 있다. <Br>
그럼 쿠폰도 상품 도메인이 확인하나? 등급은? 구매 금액은? <Br>
**어떤 도메인 로직이 여러 엔티티와 밸류를 필요로 하는 경우, <br> 도메인 서비스에서 로직을 구현할 수 있다.** <Br>

## Reference
- 도메인 주도 개발 시작하기 <최범균 저>
